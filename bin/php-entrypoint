#!/bin/sh
# Entrypoint script for php container.
#
# Ensures file permissions are setup correctly for cron, and
# starts the cron daemon and php.

set -e

echo "Starting application in ${PWD}"
echo "Composer version: $(composer --version)"

# Ensure crontabs have expected owners and permissions.
# Done here to allow mounting the crontab as a volume within docker-compose.yml.
chown root:root /etc/cron.d/*
chmod 0644 /etc/cron.d/*

# Start cron; it's a daemon by default.
service cron start

# Build site assets
/var/www/bin/build.sh

# Start application; run in foreground, as that's what Docker prefers
echo "Starting web server"
exec vendor/bin/laminas mezzio:swoole:start
